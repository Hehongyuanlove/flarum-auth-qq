module.exports=function(t){var o={};function e(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var r in t)e.d(n,r,function(o){return t[o]}.bind(null,r));return n},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p="",e(e.s=12)}([function(t,o,e){"use strict";function n(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o}e.d(o,"a",(function(){return n}))},function(t,o){t.exports=flarum.core.compat.app},function(t,o){t.exports=flarum.core.compat["components/Button"]},function(t,o){t.exports=flarum.core.compat["forum/app"]},function(t,o){t.exports=flarum.core.compat.extend},function(t,o){t.exports=flarum.core.compat["components/LogInButtons"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return QQLogInButton}));var _babel_runtime_helpers_esm_inheritsLoose__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),flarum_app__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),flarum_app__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(flarum_app__WEBPACK_IMPORTED_MODULE_1__),flarum_components_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),flarum_components_Button__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(flarum_components_Button__WEBPACK_IMPORTED_MODULE_2__),QQLogInButton=function(_Button){function QQLogInButton(){return _Button.apply(this,arguments)||this}Object(_babel_runtime_helpers_esm_inheritsLoose__WEBPACK_IMPORTED_MODULE_0__.a)(QQLogInButton,_Button),QQLogInButton.initAttrs=function(t){t.authsQQ=this.authsQQ,_Button.initAttrs.call(this,t)};var _proto=QQLogInButton.prototype;return _proto.view=function(t){var o=_Button.prototype.view.call(this,t);return o.attrs.onclick=this.checkH5.bind(this),o.attrs.className+=" LogInButton",o},_proto.checkH5=function(){console.log(this);var t=$(window);window.open(flarum_app__WEBPACK_IMPORTED_MODULE_1___default.a.forum.attribute("apiUrl")+"/auth/qqlogin","LinkPopup","width=600,height=400,top="+(t.height()/2-200)+",left="+(t.width()/2-300)+",status=no,scrollbars=no,resizable=no"),this.loading=!0},_proto.authLogin=function(){var t=this;this.authsQQ.login((function(o){o.target.authResult;t.authUserInfo()}),(function(t){alert("登录认证失败！")}),{})},_proto.authLogout=function(){for(var t in this.auths){var o=auths[t];o.authResult&&o.logout((function(t){alert("注销登录认证成功！")}),(function(t){alert("注销登录认证失败！")}))}},_proto.authUserInfo=function authUserInfo(){var s=this.authsQQ;s.authResult?s.getUserInfo((function(e){var pload={openid:s.authResult.openid,access_token:s.authResult.access_token,pay_token:s.authResult.pay_token,nickname:s.userInfo.nickname,figureurl_qq_2:s.userInfo.figureurl_qq_2},prame=escape(JSON.stringify(pload));m.request({method:"GET",url:"/api/authh5/qq?param="+prame,deserialize:function(t){return t}}).then((function(result){result=result.replace("window.close();",""),result=result.replace(".opener",""),result=result.replace("<script>",""),result=result.replace(";<\/script>",""),eval(result)})).catch((function(t){console.log(t)}))}),(function(t){alert("获取用户信息失败："+t.message+" - "+t.code)})):alert("未登录授权！")},QQLogInButton}(flarum_components_Button__WEBPACK_IMPORTED_MODULE_2___default.a)},function(t,o){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,o){t.exports=flarum.core.compat["components/Modal"]},,function(t,o){t.exports=flarum.core.compat["forum/components/Page"]},function(t,o){t.exports=flarum.core.compat["forum/Component"]},function(t,o,e){"use strict";e.r(o);var n=e(4),r=e(1),u=e.n(r),a=e(5),i=e.n(a),s=e(6),c=e(0),_=e(3),l=e.n(_),p=(e(10),e(11),e(7)),f=e.n(p),h=e(8),d=e.n(h),g=e(2),E=e.n(g),b=function(t){function o(){return t.apply(this,arguments)||this}Object(c.a)(o,t);var e=o.prototype;return e.oninit=function(o){var e=this;t.prototype.oninit.call(this,o);var n=o.attrs,r=n.qq_code,u=n.qq_state;this.isError=!1,this.msgError="",r&&u?m.request({method:"GET",url:"/api/auth/qq/"+r+"/"+u}).then((function(t){if(console.log("result",t),t.token||t.loggedIn)return window.opener?(window.opener.app.authenticationComplete(t),void window.close()):(app.authenticationComplete(t),void(window.location.href=app.forum.attribute("baseUrl")));e.setError(t)})).catch((function(t){console.log(t),e.setError(t)})):this.setError({msg:"信息缺失",code:r,state:u})},e.className=function(){return"QQ LinkModal Modal--small"},e.setError=function(t){this.isError=!0,this.msgError=JSON.stringify(t)},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},isError?"":m("div",null," 正在登录 请稍候 "),isError?m("div",null," 登录发生异常 "):"",isError?m("div",null," ",this.msgError," "):"",isError?E.a.component({className:"Button",onclick:function(){window.location.href=app.forum.attribute("baseUrl")}},"返回主页重新登录"):""))},o}(d.a),q=function(t){function o(){return t.apply(this,arguments)||this}Object(c.a)(o,t);var e=o.prototype;return e.oncreate=function(o){if(t.prototype.oncreate.call(this,o),l.a.session.user)window.location.href=l.a.forum.attribute("baseUrl");else{console.log(o);var e=o.attrs.code,n=o.attrs.state;e&&e&&setTimeout((function(){return l.a.modal.show(b,{qq_code:e,qq_state:n})}),200)}},e.getUrlParam=function(t){var o=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),e=window.location.search.substr(1).match(o);return null!=e?decodeURI(e[2]):null},o}(f.a);u.a.initializers.add("hehongyuanlove-auth-qq",(function(){Object(n.extend)(i.a.prototype,"items",(function(t){t.add("QQAndH5",m(s.a,{className:"Button LogInButton--QQ",icon:"fab fa-qq"},u.a.translator.trans("hehongyuanlove-auth-qq.forum.log_in.with_qq_button")))})),u.a.routes["hhy-auth-qq"]={path:"/auth/qq",component:q}}))}]);
//# sourceMappingURL=forum.js.map